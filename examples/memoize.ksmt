defn [memoized f] {
  := cache [map]
  fn [get_or_set cache $all [call f $all]]
}

defmcr memoize [eval [call_expr [name_expr "::="] $0 [call_expr [name_expr "memoized"] $0]] $context]

defn [nth_fibonacci n] [check n
    zero 1
    one 1
    [+ [nth_fibonacci [- n 1]]
       [nth_fibonacci [- n 2]]]]

memoize nth_fibonacci

assert_is [nth_fibonacci 40] 102334155