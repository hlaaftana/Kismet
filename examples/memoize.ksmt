defn [memoized f] {
  := cache [map]
  fn [get_or_set cache $all [call f $all]]
}

:= memoize [tmpl [call_expr [static_expr ::=] $0 [call_expr [name_expr "memoized"] $0]]]

defn [nth_fibonacci n] [check n
  zero 1
  one 1
  [sum [collect [range [decr n] [decr n]] nth_fibonacci]]]

memoize nth_fibonacci

assert_is [nth_fibonacci 40] 165580141