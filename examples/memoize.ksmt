defn [memoized f] {
    := cache [map]
    fn [pick cache[$all] [= cache[$all] [call f $all]]]
}

defmcr memoize [eval [call_expr [name_expr "::="] $0 [call_expr [name_expr "memoized"] $0]] $block]

defn [nth_fibonacci n] [check n
    zero 1
    one 1
    [+ [nth_fibonacci [- n 1]]
       [nth_fibonacci [- n 2]]]]

memoize nth_fibonacci